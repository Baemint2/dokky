<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mcp.semi.user.mapper.UserMapper">

<insert id="setSignup"
		parameterType="UserDto">
	INSERT INTO USER_T (
				USER_NO
			  , USER_EMAIL
			  , USER_PW
			  , USER_NAME
			  , USER_GENDER
			  , USER_MOBILE
			  , SIGNUP_DT
			  , PW_MODIFY_DT
	) VALUES (
				USER_SEQ.NEXTVAL
			  , #{userEmail}
			  , #{userPw}
			  , #{userName}
			  , #{userGender}
			  , #{userMobile}
			  , CURRENT_DATE
			  , CURRENT_DATE
	)
</insert>

<insert id="insertAccessHistory"
          parameterType="Map">       
    INSERT INTO ACCESS_HISTORY_T (
		        ACCESS_HISTORY_NO
		      , USER_EMAIL
		      , ACCESS_IP
		      , USER_AGENT
		      , SESSION_ID
		      , LOGIN_DT
		      , LOGOUT_DT
    ) VALUES (
		        ACCESS_HISTORY_SEQ.NEXTVAL
		      , #{userEmail}
		      , #{accessIp}
		      , #{userAgent}
		      , #{sessionId}
		      , CURRENT_DATE
		      , NULL
    )    
</insert>

<update id="updateAccessHistory">
	UPDATE ACCESS_HISTORY_T
	   SET SIGNOUT_DT = CURRENT_DATE
	 WHERE SESSION_ID = #{sessionId}
</update>


<select id="findByUserNo"
			 parameterType="int" resultType="UserDto">
	SELECT USER_NO, USER_EMAIL, USER_PW, USER_NAME, 
		   USER_GENDER, USER_MOBILE, USER_IMG 
  	  FROM USER_T
 	 WHERE USER_NO = #{userNo}
</select>

 
</mapper>
